spring:
  # üöÄ Memory Optimization - Lazy initialization
  main:
    lazy-initialization: true
  
  # üóÑÔ∏è Database Configuration
  datasource:
    url: jdbc:postgresql://postgres:5432/edu_db
    username: edu_admin
    password: edu_password
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 5      # Reduced from default 10
      minimum-idle: 2            # Reduced connections
      connection-timeout: 20000
      idle-timeout: 300000

  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
  
  # üì¶ Deferred JPA repository loading
  data:
    jpa:
      repositories:
        bootstrap-mode: deferred
    # üî¥ Redis Configuration
    redis:
      host: ${REDIS_HOST:redis}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}  # ‚úÖ ADDED: Redis password support
      database: ${REDIS_DB:0}
      timeout: 60000
      lettuce:
        pool:
          max-active: 4      # Reduced from default 8
          max-idle: 2        # Reduced from default 8
          min-idle: 1        # Reduced from default 0
          max-wait: -1ms

  sql:
    init:
      mode: always
      platform: postgres

  servlet:
    multipart:
      max-file-size: 500MB
      max-request-size: 500MB

# üîê JWT Configuration
jwt:
  secret: ${JWT_SECRET:change-this-super-secret-key-of-32-chars-min}
  access-token-expiration-ms: 900000
  refresh-token-expiration-ms: 604800000
  issuer: edu-platform

# üåê Server Configuration
server:
  port: 8080
  address: 0.0.0.0
  servlet:
    context-path: /api/v1
  tomcat:
    threads:
      max: 50              # Reduced from default 200
      min-spare: 5         # Reduced from default 10

# üì± Application Configuration
app:
  backend-base-url: ${APP_BACKEND_BASE_URL:http://localhost:8080/api/v1}

# ‚òÅÔ∏è AWS S3 Configuration
aws:
  s3:
    bucket-name: ${AWS_S3_BUCKET_NAME:haybee-edu-lessons}
    region: ${AWS_S3_REGION:us-east-1}
  access-key-id: ${AWS_ACCESS_KEY_ID}
  secret-access-key: ${AWS_SECRET_ACCESS_KEY}

# üé• Zoom Configuration
zoom:
  account-id: ${ZOOM_ACCOUNT_ID}
  client-id: ${ZOOM_CLIENT_ID}
  client-secret: ${ZOOM_CLIENT_SECRET}
  api-base-url: https://api.zoom.us/v2
  oauth-token-url: https://zoom.us/oauth/token

# üì∫ YouTube Configuration
youtube:
  client-id: ${YOUTUBE_CLIENT_ID}
  client-secret: ${YOUTUBE_CLIENT_SECRET}
  redirect-uri: ${YOUTUBE_REDIRECT_URI:http://localhost:8080/api/v1/oauth/youtube/callback}
  api-base-url: https://www.googleapis.com/youtube/v3
  authorization-url: https://accounts.google.com/o/oauth2/v2/auth
  token-url: https://oauth2.googleapis.com/token
  scopes:
    - https://www.googleapis.com/auth/youtube.upload
    - https://www.googleapis.com/auth/youtube.readonly

# üì¶ MinIO Configuration
minio:
  endpoint: ${MINIO_ENDPOINT:minio:9000}
  access-key: ${MINIO_ACCESS_KEY:minioadmin}
  secret-key: ${MINIO_SECRET_KEY:minioadmin123}
  secure: ${MINIO_SECURE:false}
  buckets:
    videos: edu-videos
    recordings: edu-recordings
    thumbnails: edu-thumbnails

# üîê System Configuration
system:
  token: ${SYSTEM_TOKEN}

# üêç Python Service Configuration
python-service:
  base-url: http://python-service:8000
  system-token: ${SYSTEM_TOKEN}

# ============================================================
# ‚úÖ SPRINT 5: INDIVIDUAL STUDENT ASSESSMENT WINDOWS
# ============================================================

individual:
  assessment:
    pre-window:
      minutes: 30
    grace-period:
      hours: 2
    late-submission:
      tolerance:
        minutes: 5
    strict-deadline:
      enabled: true
    cross-day-submission:
      enabled: false

  schedule:
    weekday:
      start: "16:00"
      end: "18:00"
    saturday:
      start: "12:00"
      end: "15:00"
    sunday:
      enabled: false

  tasks:
    assessment-opener:
      enabled: true
      interval-minutes: 10
      batch-size: 100
    grace-expiry:
      enabled: true
      interval-minutes: 15
      batch-size: 100
    weekly-generation:
      enabled: true

  assessment-available:
    notify:
      student: true
  assessment-expired:
    notify:
      student: true
      teacher: true
  assessment-completed:
    notify:
      teacher: true

# ============================================================
# ‚úÖ ASSESSMENT WINDOW RESCHEDULING (Teacher Control)
# Allows teachers to proactively reschedule assessments BEFORE they start
# Prevents cheating by cancelling original window
# ============================================================

assessment-reschedule:
  # Require reason for rescheduling
  require-reason: true
  
  # Minimum reason length (characters)
  min-reason-length: 10
  
  # Maximum future time for rescheduling (months)
  # Cannot reschedule more than 3 months ahead
  max-future-months: 3
  
  # Window duration (hours) - FIXED at 1 hour
  # All rescheduled assessments get exactly 1 hour
  window-duration-hours: 1
  
  # Grace period after window end (minutes)
  # Student gets 30 extra minutes after window closes
  grace-period-minutes: 30

# üìä Logging Configuration
logging:
  level:
    root: INFO
    org.springframework.web: INFO
    org.springframework.security: INFO
    org.hibernate.SQL: WARN
    com.edu.platform: DEBUG
    com.edu.platform.service.individual.AssessmentWindowCalculator: DEBUG
    com.edu.platform.service.individual.AssessmentAccessibilityService: DEBUG
    com.edu.platform.service.individual.GracePeriodExpiryService: DEBUG
    com.edu.platform.service.assessment.AssessmentWindowRescheduleService: DEBUG
    com.edu.platform.scheduler.AssessmentWindowOpenerTask: INFO
    com.edu.platform.scheduler.GracePeriodExpiryTask: INFO

# üìà Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
  endpoint:
    health:
      show-details: WHEN_AUTHORIZED

# üîå Supabase Configuration
supabase:
  url: ${SUPABASE_URL:}
  anon-key: ${SUPABASE_ANON_KEY:}
  service-role-key: ${SUPABASE_SERVICE_ROLE_KEY:}